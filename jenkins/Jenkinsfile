pipeline {
    agent any 
        
    environment {
        CI = 'true'
        HOME = '.'
        
    }
   
    stages {
        
        stage('Clone sources') {
        
        steps {
        
        git url: 'https://github.com/nickgulrajani/simple-node-js-react-npm-app/'
                             }
        }
        stage('Build') {
            steps {
                sh 'echo "Hello World"'
//                sh '/usr/local/bin/npm install'
                  sh './jenkins/scripts/test.sh'
            }
        }
        stage('Test') {
            steps {
                sh './jenkins/scripts/test.sh'
            }
        }
//stage('Sonarqube') {
//          environment {
 //           scannerHome = tool 'sonar'
 //           }
    
  //      steps {
   //         sh 'echo "$PATH"'       
    //        withSonarQubeEnv('sonar') {
     //       sh "${scannerHome}/sonar-scanner"
      //  }
    // }
// }             

stage ('CodeQuality'){
          steps {
              dir('/Users/gulrajan/GITHUB/simple-node-js-react-npm-app')
           {
              sh "pwd"
              sh "/opt/sonar-scanner-4.3.0.2102-macosx/bin/sonar-scanner -X" 
              
            }
          }
      }
        stage('Deliver') {
            steps {
                sh './jenkins/scripts/deliver.sh'
                input message: 'Finished using the web site? (Click "Proceed" to continue)'
                sh './jenkins/scripts/kill.sh'
            }
        }
    }
}
